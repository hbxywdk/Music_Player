!function(){function t(t){for(var e=t.offsetLeft,n=t.offsetParent;null!==n;)e+=n.offsetLeft,n=n.offsetParent;return e}function e(t){return document.querySelector(t)}function n(t){var e;if(!(t<0)){if(t<10)e="0:0"+t;else if(t<60)e="0:"+t;else if(t>=60){var n=parseInt(t/60),i=t%60;i<10&&(i="0"+i),e=n+":"+i}return e}}var i={mainAudia:e("#mainAudia"),listsbt:e("#listsbt"),lists:e(".side"),bg:e(".main_bg"),music_name:e(".music_info1"),time_now:e(".time_now"),time_all:e(".time_all"),prev_b:e(".prev"),next_b:e(".next"),stop_b:e(".stop"),play_type_b:e(".play_type"),jd_col_bar:e(".jd_col_bar"),jd_info:e(".jd_info"),jd_now_bar:e(".jd_now_bar"),sound:e(".sound"),sound_bar:e(".sound_bar"),sound_now_bar:e(".now_bar"),col_bar:e(".col_bar"),text:e(".text"),myword:e("#myword"),change_line:e(".change_line"),myword_top:0,inDrag:!1,data:"",is_mute:!1,serial:0,stop_key:!1,play_type:1,lines:0,is_drag_progress:!1,init:function(t){this.data=t,this.listshow(),this.addMisic(),this.change(this.serial),this.addButtonFuc(),this.winChange()},winChange:function(){var t,e,n=this;n.change_line.style.width=n.text.offsetWidth+"px",e=Math.ceil(n.text.offsetHeight/2),n.change_line.style.top=e+"px",window.onresize=function(){clearTimeout(t),t=setTimeout(function(){n.change_line.style.width=n.text.offsetWidth+"px",e=Math.ceil(n.text.offsetHeight/2),n.change_line.style.top=e+"px"},100)}},listshow:function(){var t=this;t.listsbt.onchange=function(){1==this.checked?(t.lists.style.cssText="left:0;",t.text.style.cssText="width:60%;left:40%;"):(t.lists.style.cssText="left:-50%;",t.text.style.cssText="width:100%;left:0;"),setTimeout(function(){t.change_line.style.width=t.text.offsetWidth+"px"},300)}},js_jump:function(t){var e=this,n=Math.ceil(e.mainAudia.duration*t);e.mainAudia.currentTime=n},addMisic:function(){var t=this,e="";t.data.forEach(function(t,n){var i=new Image;i.src=t.pic,e+="<li ind="+n+'>\t\t\t\t\t\t<div class="tit">\t\t\t\t\t\t\t<div class="w70 fl ell">\t\t\t\t\t\t\t\t'+t.name+'\t\t\t\t\t\t\t\t<span class="fr icon_play">\t\t\t\t\t\t\t\t\t<div class="three_line">\t\t\t\t\t\t\t\t\t\t<div class="three_line_all three_line_1"></div>\t\t\t\t\t\t\t\t\t\t<div class="three_line_all three_line_2"></div>\t\t\t\t\t\t\t\t\t\t<div class="three_line_all three_line_3"></div>\t\t\t\t\t\t\t\t\t</div>\t\t\t\t\t\t\t\t</span>\t\t\t\t\t\t\t</div>\t\t\t\t\t\t\t<div class="w30 fl ell">\t\t\t\t\t\t\t\t'+t.singer+"\t\t\t\t\t\t\t</div>\t\t\t\t\t\t</div>\t\t\t\t\t   </li>"}),t.lists.getElementsByTagName("ul")[0].innerHTML=e,t.lists.ondblclick=function(e){var n,e=e||event,i=e.target||e.srcElement,o=i.parentNode.parentNode;"LI"===o.nodeName.toUpperCase()&&(n=Number(o.getAttribute("ind")),t.serial!==n&&t.change(n))}},change:function(t){var e=this,i=e.data[t],o=e.lists.querySelectorAll(".icon_play");Array.prototype.forEach.call(o,function(t,e){t.classList.remove("icon_play_now")}),Array.prototype.forEach.call(o,function(e,n){n===t&&e.classList.add("icon_play_now")}),e.serial=t,e.myword_top=e.myword.style.marginTop=0,e.creatText(i.text),e.stop_key=!1,e.stop_b.classList.remove("stop2"),e.music_name.innerHTML=i.name+" - "+i.singer,e.bg.style.background="url("+i.pic+") no-repeat center",e.bg.style.backgroundSize="cover",e.mainAudia.src=i.src_,e.mainAudia.addEventListener("error",function(t){throw new Error("错误")},!1);var a=setInterval(function(){4===e.mainAudia.readyState&&(clearInterval(a),e.mainAudia.play(),e.time_all.innerHTML=n(parseInt(e.mainAudia.duration)),e.listen(i.text))},50)},creatText:function(t){var e=this,n="";t.forEach(function(t,e){n+="<li>"+t[1]+"</li>"}),e.myword.innerHTML=n,e.drag_word()},jd_col:function(){var e=this;e.jd_col_bar.onmousedown=function(n){var n=n||event,i=n.pageX-t(e.jd_info);e.is_drag_progress=!0,document.onmousemove=function(n){i=n.pageX-t(e.jd_info),i<0&&(i=0),i>e.jd_info.offsetWidth&&(i=e.jd_info.offsetWidth),e.jd_col_bar.style.left=i+"px",e.jd_now_bar.style.width=i+"px"},document.onmouseup=function(t){if(document.onmousemove=null,e.is_drag_progress){var n=(i/e.jd_info.offsetWidth).toFixed(3);e.js_jump(n),e.is_drag_progress=!1}}},e.jd_info.onclick=function(n){var n=n||event,i=n.pageX-t(e.jd_info),o=(i/e.jd_info.offsetWidth).toFixed(3);e.js_jump(o)}},listen:function(t){function e(){o.endJudge(),o.mainAudia.removeEventListener("ended",e,!1)}var i,o=this;o.mainAudia.ontimeupdate=function(e){if(o.time_now.innerHTML=n(parseInt(o.mainAudia.currentTime)),!o.is_drag_progress){i=(o.mainAudia.currentTime/o.mainAudia.duration).toFixed(3);var a=Math.ceil(o.jd_info.offsetWidth*i);o.jd_col_bar.style.left=a+"px",o.jd_now_bar.style.width=a+"px"}if(!o.inDrag){for(var s=o.myword.querySelectorAll("li"),l=0;l<s.length-1;l++)s[l].classList.remove("active");var r=Math.round(Math.floor(o.text.offsetHeight/s[0].offsetHeight)/2);t.forEach(function(e,n){null!=t[n+1]&&o.mainAudia.currentTime>e[0]&&o.mainAudia.currentTime<=t[n+1][0]&&(s[n].classList.add("active"),n<r?o.myword_top=0:o.myword_top=s[0].offsetHeight*(r-n)+"px",o.myword.style.marginTop=o.myword_top)})}},o.mainAudia.addEventListener("ended",e,!1)},drag_word:function(){var t=this;t.myword.onmousedown=function(e){var n,i,o,e=e||event;t.inDrag=!t.inDrag,n=e.pageY,i=parseInt(getComputedStyle(t.myword,null).marginTop),t.myword.classList.remove("c3m"),t.change_line.style.display="block",document.onmousemove=function(e){var e=e||event,a=e.pageY-n;o=i+a,o>t.text.offsetHeight/2&&(o=t.text.offsetHeight/2),o<t.text.offsetHeight/2-t.myword.offsetHeight&&(o=t.text.offsetHeight/2-t.myword.offsetHeight),t.myword.style.marginTop=o+"px"},document.onmouseup=function(){document.onmousemove=null,t.inDrag=!t.inDrag,t.myword.classList.add("c3m"),t.change_line.style.display="none";var e=(-(o-t.text.offsetHeight/2+34)/t.myword.offsetHeight).toFixed(3);isNaN(e)||(console.log(o-t.text.offsetHeight),e<0&&(e=0),console.log(e),t.js_jump(e),document.onmouseup=null)}}},endJudge:function(){function t(){var n=Math.floor(Math.random()*e.data.length);return 1===e.data.length?0:n===e.serial?t():n}var e=this;if(1===e.play_type)e.serial++,e.serial>e.data.length-1&&(e.serial=0),e.change(e.serial);else if(3===e.play_type){var n=t();e.change(n)}},addButtonFuc:function(){var t=this;t.prev_b.onclick=function(){t.prev()},t.next_b.onclick=function(){t.next()},t.stop_b.onclick=function(){t.stop_key?(t.mainAudia.play(),t.stop_key=!t.stop_key,t.stop_b.classList.remove("stop2")):(t.mainAudia.pause(),t.stop_key=!t.stop_key,t.stop_b.classList.add("stop2"))},t.play_type_b.onclick=function(){t.change_play_type()},t.jd_col(),t.sound_col()},sound_col:function(){var e=this,n=100,i=1,o=!1,a=!1;e.col_bar.onmousedown=function(s){var s=s||event;n=s.pageX-t(e.jd_info),a=!a,document.onmousemove=function(s){var s=s||event;n=s.pageX-t(e.sound_bar),n<0&&(n=0),n>100&&(n=100),n>e.sound_bar.offsetWidth&&(n=e.sound_bar.offsetWidth),0===e.mainAudia.volume&&0===n&&!o&&a&&e.sound.click(),n>0&&o&&a&&e.sound.click(),n>e.sound_bar.offsetWidth&&(n=e.sound_bar.offsetWidth),e.col_bar.style.left=n+"px",e.mainAudia.volume=i=n/e.sound_bar.offsetWidth,e.sound_now_bar.style.width=n+"px"},document.onmouseup=function(t){a=!a,document.onmousemove=null,document.onmouseup=null}},e.sound_bar.onclick=function(s){a||(n=s.pageX-t(e.sound_bar),n<0&&(n=0,a=!a),n>100&&(n=100),e.col_bar.style.left=n+"px",e.mainAudia.volume=i=n/e.sound_bar.offsetWidth,e.sound_now_bar.style.width=n+"px",0!==e.mainAudia.volume||o||e.sound.click(),n>0&&o&&e.sound.click())},e.sound.onclick=function(){e.is_mute?(0===i&&o&&(i=.5,n=50),e.mainAudia.volume=i,e.sound_now_bar.style.width=n+"px",e.col_bar.style.left=n+"px",e.sound.classList.remove("jingyin")):(e.mainAudia.volume=0,e.sound_now_bar.style.width="0px",e.col_bar.style.left="0px",e.sound.classList.add("jingyin")),o=!o,e.is_mute=!e.is_mute}},prev:function(){var t=this;return 3===t.play_type?void t.endJudge():(t.serial--,t.serial<0&&(t.serial=t.data.length-1),t.change(t.serial),void 0)},next:function(){var t=this;return 3===t.play_type?void t.endJudge():(t.serial++,t.serial>t.data.length-1&&(t.serial=0),t.change(t.serial),void 0)},change_play_type:function(){var t=this;t.play_type++,t.play_type<1&&(t.play_type=3),t.play_type>3&&(t.play_type=1),1===t.play_type?(t.play_type_b.classList.add("shunxu"),t.play_type_b.classList.remove("suiji"),t.play_type_b.classList.remove("danqu"),t.mainAudia.loop=!1):2===t.play_type?(t.play_type_b.classList.add("danqu"),t.play_type_b.classList.remove("suiji"),t.play_type_b.classList.remove("shunxu"),t.mainAudia.loop=!0):3===t.play_type&&(t.play_type_b.classList.add("suiji"),t.play_type_b.classList.remove("danqu"),t.play_type_b.classList.remove("shunxu"),t.mainAudia.loop=!1)}};window.audioPlayer=i}();